# http://plnkr.co/edit/DJH6mQUCbTFfSbdCBYUo?p=info
# https://github.com/angular-ui/ui-router/issues/92#issuecomment-57345190
angular.module('ui.router.history', [ 'ui.router' ]).service('$history', ($state, $rootScope, $window) ->
  history = []
  angular.extend this,
    push: (state, params) ->
      history.push
        state: state
        params: params
      return
    all: ->
      history
    go: (step) ->
      # TODO:
      # (1) Determine # of states in stack with URLs, attempt to
      #    shell out to $window.history when possible
      # (2) Attempt to figure out some algorthim for reversing that,
      #     so you can also go forward
      prev = @previous(step or -1)
      $state.go prev.state, prev.params
    previous: (step) ->
      history[history.length - Math.abs(step or 1)]
    back: ->
      @go -1
  return
).run ($history, $state, $rootScope) ->
  $rootScope.$on '$stateChangeSuccess', (event, to, toParams, from, fromParams) ->
    if !from.abstract
      $history.push from, fromParams
    return
  $history.push $state.current, $state.params
  return

# ---
# generated by js2coffee 2.1.0
